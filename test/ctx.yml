{% set var_pod_kind = 'test' %}
{% set var_main_base_dir = params.main.custom_dir %}
{% set var_main_dir = var_main_base_dir + '/' + var_pod_kind %}

env_templates:

- src: "{{ params.main.env_files_dir }}/template.yml"
  dest: "env/env-template.yml"
  params:
    src: "{{ params.main.env_files_dir }}/template.yml"
    dest: "env/env-template.yml"
    params:
      prop1: 1
      prop2:
        prop2_1: 2
        prop2_2: "fgh"

files:

- src: "{{ var_main_dir }}/credentials.schema.yml"
  dest: "env/credentials.yml"

children:

- name: "{{ var_main_dir }}/ctx-child.yml"
  params:
    main: {{ params.main | to_json }}
    custom:
      value: |
        param1: {{ params.main.pod_param_1 }}$
        param2: {{ params.main.pod_param_2 }}$
        param3: {{ params.main.pod_param_3 }}$
        param4: {{ params.main.pod_param_4 | default('') }}
